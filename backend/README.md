# FastAPI Backend

A modern FastAPI backend application with PostgreSQL and async support, managed with `uv`.

## Features

- FastAPI framework with async/await support
- PostgreSQL database with SQLAlchemy 2.0
- Pydantic v2 for data validation
- Alembic for database migrations
- Environment-based configuration
- CORS middleware
- API versioning
- Health check endpoints
- Dependency management with `uv`

## Setup

### Prerequisites

- Python 3.11+
- [uv](https://github.com/astral-sh/uv) package manager
- PostgreSQL (optional, for database features)

### Installation

The project uses `uv` for dependency management. The Taskfile automates the setup:

1. Initialize the project and install dependencies:
```bash
task setup:backend
```

This will:
- Create a virtual environment
- Install all dependencies from pyproject.toml
- Generate a uv.lock file

2. Copy environment file and configure:
```bash
cp .env.example .env
# Edit .env with your configuration
```

3. Run database migrations (if using PostgreSQL):
```bash
cd backend
uv run alembic upgrade head
```

### Running the Application

Using the Taskfile (recommended):
```bash
task run:backend
```

Or manually with uv:
```bash
cd backend
uv run uvicorn main:app --reload
```

The API will be available at http://localhost:8000

### API Documentation

Once running, access the interactive API documentation:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Development

### Adding Dependencies

Add a new dependency:
```bash
cd backend
uv add <package-name>
```

Add a development dependency:
```bash
uv add --dev <package-name>
```

### Code Quality

Format code with Black:
```bash
uv run black app/
```

Lint code with Ruff:
```bash
uv run ruff check app/
```

Type checking with mypy:
```bash
uv run mypy app/
```

### Testing

Run tests:
```bash
uv run pytest
```

With coverage:
```bash
uv run pytest --cov=app --cov-report=html
```

### Database Migrations

Create a new migration:
```bash
uv run alembic revision --autogenerate -m "description"
```

Apply migrations:
```bash
uv run alembic upgrade head
```

Rollback migration:
```bash
uv run alembic downgrade -1
```

## Project Structure

```
backend/
├── app/
│   ├── __init__.py
│   ├── config.py            # Configuration settings
│   ├── api/
│   │   ├── __init__.py
│   │   ├── deps.py          # API dependencies
│   │   └── v1/
│   │       ├── __init__.py
│   │       ├── router.py    # API v1 router
│   │       └── endpoints/
│   │           ├── __init__.py
│   │           ├── health.py
│   │           └── items.py
│   ├── core/
│   │   ├── __init__.py
│   │   ├── security.py      # Security utilities
│   │   └── database.py      # Database connection
│   ├── models/
│   │   ├── __init__.py
│   │   └── item.py          # SQLAlchemy models
│   ├── schemas/
│   │   ├── __init__.py
│   │   └── item.py          # Pydantic schemas
│   └── services/
│       ├── __init__.py
│       └── item.py          # Business logic
├── alembic/
│   ├── versions/
│   ├── env.py
│   ├── script.py.mako
│   └── README
├── tests/
│   ├── __init__.py
│   └── test_main.py
├── main.py                  # Application entry point
├── .env.example
├── .gitignore
├── alembic.ini
├── pyproject.toml
├── uv.lock                  # Generated by uv
└── README.md
```

## API Endpoints

### Health Check
- `GET /api/v1/health` - Health check endpoint

### Items (Example CRUD)
- `GET /api/v1/items` - List all items
- `GET /api/v1/items/{id}` - Get item by ID
- `POST /api/v1/items` - Create new item
- `PUT /api/v1/items/{id}` - Update item
- `DELETE /api/v1/items/{id}` - Delete item

## Environment Variables

See [.env.example](.env.example) for all available configuration options.

Key variables:
- `DATABASE_URL` - PostgreSQL connection string
- `BACKEND_CORS_ORIGINS` - Allowed CORS origins
