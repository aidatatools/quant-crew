# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: '3'

vars:
  GREETING: Hello, world!

tasks:
  default:
    desc: Print a greeting message
    cmds:
      - echo "{{.GREETING}}"
    silent: true

  # This replaces your manual 'uv venv' and 'pip install' steps
  setup:backend:
    desc: "Create venv and sync dependencies"
    dir: backend
    cmds:
      - uv sync
    sources:
      - pyproject.toml
      - uv.lock
    generates:
      - .venv/pyvenv.cfg  # Tells Task the venv is now "ready"

  # The run task depends on setup being done
  run:backend:
    desc: "Start FastAPI"
    deps: [setup:backend]
    dir: backend
    cmds:
      - uv run uvicorn main:app --reload